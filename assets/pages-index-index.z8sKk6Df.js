import{A as l,B as e,C as a,D as t,E as u,a as o,b as s,s as n,i as c,o as i,g as r,k as d,t as v,l as f,m as p,F as y,h as _,G as m,H as g,I as h,J as k,K as C,x as q,L as b,p as w,M as x,S as F,n as I,z as S}from"./index-BQ09tla7.js";import{n as O}from"./newRequest.CdYp5UiF.js";import N from"./pages-ProductDetailModal-ProductDetailModal.kvwv9w2O.js";import j from"./pages-FlavorSelectModal-FlavorSelectModal.DDmVJY2z.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";const J=M({__name:"index",setup(M){const J=l([]),A=l({}),L=l([]),D=l(!0),E=l(null),P=l([]),$=l(""),z=l(""),R=l(!1),T=l(!1),V=l(!1),G=l(null),Q=l(1),B=l([]),H=l([]),K=l(null),U=l(null),W=l(""),X=e((()=>{if(!W.value)return Object.values(A.value).flat();const l=W.value.toLowerCase();return J.value.filter((e=>e.name.toLowerCase().includes(l)))})),Y=e((()=>P.value.reduce(((l,e)=>l+parseFloat(e.price)*e.quantity),0))),Z=e((()=>P.value.reduce(((l,e)=>l+e.quantity),0))),ll=l=>P.value.reduce(((e,a)=>a.productId===l?e+a.quantity:e),0),el=l=>{if(W.value)return 0;const e=(A.value[l]||[]).map((l=>l.id));return P.value.reduce(((l,a)=>e.includes(a.productId)?l+a.quantity:l),0)},al=e((()=>{const l=new Set;return P.value.forEach((e=>{l.add(e.productId)})),l.size})),tl=()=>{R.value=!1,T.value=!1,V.value=!1};a(W,((l,e)=>{l?(E.value=null,$.value="",z.value=""):L.value.length>0&&(E.value=L.value[0].id,h((()=>{$.value="category-left-"+L.value[0].id,z.value="category-"+L.value[0].id})))}));const ul=async()=>{D.value=!0;try{const l=await O("http://192.168.3.150:5921","/getGoodsList","POST",null,{},!0,null);l&&200===l.code?(J.value=l.data||[],(l=>{const e=l.reduce(((l,e)=>{const a=e.categoryId;return l[a]||(l[a]=[]),l[a].push(e),l}),{});A.value=e;const a=Object.keys(e).map((l=>{const a=e[l][0];return{id:l,name:a?a.type_name:`分类 ${l}`}}));L.value=a,L.value.length>0&&!W.value&&(E.value=L.value[0].id,h((()=>{$.value="category-left-"+L.value[0].id,z.value="category-"+L.value[0].id})))})(J.value)):(J.value=[],A.value={},L.value=[],n({title:l.msg||"获取商品数据失败",icon:"none"}))}catch(l){console.error("获取商品数据出错:",l),J.value=[],A.value={},L.value=[],n({title:"获取商品数据异常",icon:"none"})}finally{D.value=!1}},ol=l=>{W.value||(l.detail.scrollTop,!D.value&&L.value.length>0&&k().selectAll(".category-section").boundingClientRect((l=>{let e=1/0,a=null;l.forEach((l=>{if(!l)return;const t=C(10);if(l.top<=t&&Math.abs(l.top)<Math.abs(e)){e=l.top;const t=l.id.replace("category-","");a=t}else if(l.top>t&&l.top<C(200)&&l.top<e){e=l.top;const t=l.id.replace("category-","");a=t}})),null!==a&&E.value!==a&&(E.value=a,h((()=>{$.value="category-left-"+a})))})).exec())},sl=l=>{tl(),G.value=l,R.value=!0},nl=l=>{G.value=l,Q.value=1,B.value=[];H.value.length>0?(R.value=!1,V.value=!1,T.value=!0):(il({product:l,flavors:[],quantity:1}),tl())},cl=({product:l,quantity:e})=>{V.value=!1,G.value=l,Q.value=e,B.value=[],T.value=!0},il=({product:l,flavors:e,quantity:a})=>{const t={productId:l.id,productName:l.name,price:l.price,flavor:e?e.sort():[],quantity:a},u=P.value.findIndex((l=>l.productId===t.productId&&JSON.stringify(l.flavor)===JSON.stringify(t.flavor)));u>-1?P.value[u].quantity+=a:P.value.push(t),P.value=[...P.value],tl(),n({title:"已加入购物车",icon:"success",duration:1e3})},rl=l=>{if((l=>{const e=P.value.filter((e=>e.productId===l));if(e.length<=1)return!1;const a=new Set;return e.forEach((l=>{const e=l.flavor?[...l.flavor].sort():[];a.add(JSON.stringify(e))})),a.size>1})(l.id))tl(),V.value=!0;else{const e=P.value.findIndex((e=>e.productId===l.id));e>-1?(P.value[e].quantity--,P.value[e].quantity<=0&&P.value.splice(e,1),P.value=[...P.value],n({title:"数量 -1",icon:"none",duration:500}),h((()=>{0===P.value.length&&V.value&&tl()}))):console.warn("App.vue: handleDecrementItem found no item for product",l.id)}},dl=()=>{V.value?vl():(tl(),P.value.length>0?V.value=!0:n({title:"购物车是空的",icon:"none"}))},vl=()=>{V.value=!1},fl=({productId:l,flavor:e,quantity:a})=>{const t=P.value.findIndex((a=>a.productId===l&&JSON.stringify(a.flavor)===JSON.stringify(e)));t>-1?(a<=0?P.value.splice(t,1):P.value[t].quantity=a,P.value=[...P.value],h((()=>{0===P.value.length&&V.value&&tl()}))):console.warn("App.vue: Received update-quantity for non-existent item in modal",{productId:l,flavor:e})},pl=()=>{P.value=[],tl(),n({title:"购物车已清空",icon:"none",duration:1e3})},yl=()=>{if(0!==P.value.length)try{q("checkoutCart",JSON.stringify(P.value)),b({url:`/pages/orderConfirm/orderConfirm?tableNumber=${K.value}&peopleCount=${U.value}`})}catch(l){console.error("Failed to store cart data:",l),n({title:"跳转结算失败",icon:"none"})}else n({title:"购物车是空的哦",icon:"none"})},_l=l=>{if(!l||!l.name)return"/static/placeholder.png";return`/static/dishes/${l.name}.png`};return t((()=>{K.value=u("table_num"),U.value=u("number_of_diners"),ul(),(async()=>{try{const l=await O("http://192.168.3.150:5921","/getCustomerList","POST",null,{},!1,null);l&&200===l.code&&Array.isArray(l.data)?H.value=l.data.map((l=>l.vc_name)).filter((l=>null!=l)):(H.value=[],n({title:l.msg||"获取口味失败",icon:"none"}))}catch(l){console.error("获取口味数据出错:",l),H.value=[],n({title:"获取口味数据异常",icon:"none"})}})()})),(l,e)=>{const a=w,t=x,u=c,n=F,h=S;return i(),o(u,{class:"app-container"},{default:s((()=>[r(u,{class:"app-header"},{default:s((()=>[r(u,{class:"header-content"},{default:s((()=>[r(a,{class:"header-info"},{default:s((()=>[d("桌号: "+v(K.value||"未知"),1)])),_:1}),r(a,{class:"header-info"},{default:s((()=>[d("人数: "+v(U.value||"未知"),1)])),_:1}),r(u,{class:"search-container"},{default:s((()=>[r(a,{class:"search-icon"},{default:s((()=>[d("🔍")])),_:1}),r(t,{class:"search-input",type:"text",placeholder:"搜索菜品",modelValue:W.value,"onUpdate:modelValue":e[0]||(e[0]=l=>W.value=l)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),r(u,{class:"main-content"},{default:s((()=>[W.value?_("",!0):(i(),o(n,{key:0,"scroll-y":"",class:"category-sidebar","scroll-into-view":$.value,"scroll-with-animation":""},{default:s((()=>[(i(!0),f(y,null,p(L.value,(l=>(i(),o(u,{key:l.id,id:"category-left-"+l.id,class:I(["category-item",{active:E.value===l.id}]),onClick:e=>{return a=l.id,void(W.value||(E.value=a,z.value="category-"+a,$.value="category-left-"+a));var a}},{default:s((()=>[r(a,null,{default:s((()=>[d(v(l.name),1)])),_:2},1024),el(l.id)>0?(i(),o(u,{key:0,class:"category-quantity-badge"},{default:s((()=>[d(v(el(l.id)),1)])),_:2},1024)):_("",!0)])),_:2},1032,["id","class","onClick"])))),128))])),_:1},8,["scroll-into-view"])),!D.value&&L.value.length>0&&!W.value?(i(),o(n,{key:1,"scroll-y":"",class:"product-list","scroll-into-view":z.value,"scroll-with-animation":"",onScroll:ol},{default:s((()=>[(i(!0),f(y,null,p(L.value,(l=>(i(),o(u,{key:l.id,id:"category-"+l.id,class:"category-section"},{default:s((()=>[r(u,{class:"category-title-wrapper"},{default:s((()=>[r(u,{class:"decoration-lines left"},{default:s((()=>[r(u,{class:"decoration-line line-3"}),r(u,{class:"decoration-line line-2"}),r(u,{class:"decoration-line line-1"})])),_:1}),r(a,{class:"category-title-text"},{default:s((()=>[d(v(l.name),1)])),_:2},1024),r(u,{class:"decoration-lines right"},{default:s((()=>[r(u,{class:"decoration-line line-1"}),r(u,{class:"decoration-line line-2"}),r(u,{class:"decoration-line line-3"})])),_:1})])),_:2},1024),r(u,{class:"products"},{default:s((()=>[(i(!0),f(y,null,p(A.value[l.id],(l=>(i(),o(u,{key:l.id,class:I(["product-item",{"has-quantity-control":ll(l.id)>0}]),onClick:e=>sl(l)},{default:s((()=>[r(h,{src:_l(l),mode:"aspectFill",class:"product-image"},null,8,["src"]),r(u,{class:"product-info"},{default:s((()=>[r(a,{class:"product-name"},{default:s((()=>[d(v(l.name),1)])),_:2},1024),r(a,{class:"product-price"},{default:s((()=>[d("¥"+v(parseFloat(l.price).toFixed(2))+"/份",1)])),_:2},1024)])),_:2},1024),ll(l.id)>0?(i(),o(u,{key:0,class:"quantity-control-product-list"},{default:s((()=>[r(u,{class:"quantity-button-product-list",onClick:g((e=>rl(l)),["stop"])},{default:s((()=>[d("-")])),_:2},1032,["onClick"]),r(a,{class:"quantity-text-product-list"},{default:s((()=>[d(v(ll(l.id)),1)])),_:2},1024),r(u,{class:"quantity-button-product-list",onClick:g((e=>nl(l)),["stop"])},{default:s((()=>[d("+")])),_:2},1032,["onClick"])])),_:2},1024)):(i(),o(u,{key:1,class:"add-button",onClick:g((e=>nl(l)),["stop"])},{default:s((()=>[r(a,null,{default:s((()=>[d("+")])),_:1})])),_:2},1032,["onClick"]))])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1032,["id"])))),128))])),_:1},8,["scroll-into-view"])):!D.value&&W.value?(i(),o(n,{key:2,"scroll-y":"",class:"product-list"},{default:s((()=>[r(u,{class:"products"},{default:s((()=>[(i(!0),f(y,null,p(X.value,(l=>(i(),o(u,{key:l.id,class:I(["product-item",{"has-quantity-control":ll(l.id)>0}]),onClick:e=>sl(l)},{default:s((()=>[r(h,{src:_l(l),mode:"aspectFill",class:"product-image"},null,8,["src"]),r(u,{class:"product-info"},{default:s((()=>[r(a,{class:"product-name"},{default:s((()=>[d(v(l.name),1)])),_:2},1024),r(a,{class:"product-price"},{default:s((()=>[d("¥"+v(parseFloat(l.price).toFixed(2))+"/份",1)])),_:2},1024)])),_:2},1024),ll(l.id)>0?(i(),o(u,{key:0,class:"quantity-control-product-list"},{default:s((()=>[r(u,{class:"quantity-button-product-list",onClick:g((e=>rl(l)),["stop"])},{default:s((()=>[d("-")])),_:2},1032,["onClick"]),r(a,{class:"quantity-text-product-list"},{default:s((()=>[d(v(ll(l.id)),1)])),_:2},1024),r(u,{class:"quantity-button-product-list",onClick:g((e=>nl(l)),["stop"])},{default:s((()=>[d("+")])),_:2},1032,["onClick"])])),_:2},1024)):(i(),o(u,{key:1,class:"add-button",onClick:g((e=>nl(l)),["stop"])},{default:s((()=>[r(a,null,{default:s((()=>[d("+")])),_:1})])),_:2},1032,["onClick"]))])),_:2},1032,["class","onClick"])))),128))])),_:1}),0===X.value.length?(i(),o(u,{key:0,class:"empty-data-placeholder"},{default:s((()=>[r(a,null,{default:s((()=>[d("未找到相关菜品")])),_:1})])),_:1})):_("",!0)])),_:1})):D.value?(i(),o(u,{key:3,class:"loading-placeholder"},{default:s((()=>[r(a,null,{default:s((()=>[d("加载中...")])),_:1})])),_:1})):(i(),o(u,{key:4,class:"empty-data-placeholder"},{default:s((()=>[r(a,null,{default:s((()=>[d("暂无商品数据")])),_:1})])),_:1}))])),_:1}),!D.value&&L.value.length>0?(i(),o(u,{key:0,class:"app-footer"},{default:s((()=>[r(u,{class:"cart-info",onClick:dl},{default:s((()=>[m("span",{class:"cart-icon"},"🛒"),m("span",{class:"cart-amount"},"¥"+v(Y.value.toFixed(2)),1),Z.value>0?(i(),f("span",{key:0,class:"total-cart-quantity"},v(Z.value),1)):_("",!0)])),_:1}),r(u,{class:"checkout-button",onClick:yl},{default:s((()=>[r(a,null,{default:s((()=>[d("选好了")])),_:1})])),_:1})])),_:1})):_("",!0),V.value?(i(),o(u,{key:1,class:"cart-detail-modal-overlay",onClick:g(vl,["self"])},{default:s((()=>[r(u,{class:"cart-detail-modal-content",onClick:e[1]||(e[1]=g((()=>{}),["stop"]))},{default:s((()=>[r(u,{class:"modal-header"},{default:s((()=>[r(u,{class:"header-title-group"},{default:s((()=>[r(a,{class:"selected-title"},{default:s((()=>[d("已选")])),_:1}),r(a,{class:"current-dishes-title"},{default:s((()=>[d("当前菜品: "+v(al.value),1)])),_:1}),r(a,{class:"ordered-title"},{default:s((()=>[d("| 已下单: 0")])),_:1})])),_:1}),r(u,{class:"clear-cart",onClick:pl},{default:s((()=>[r(a,null,{default:s((()=>[d("清空")])),_:1})])),_:1})])),_:1}),r(n,{"scroll-y":"",class:"cart-items-list"},{default:s((()=>[(i(!0),f(y,null,p(P.value,((l,e)=>(i(),o(u,{key:e,class:"cart-item"},{default:s((()=>[r(u,{class:"item-details"},{default:s((()=>[r(u,{class:"item-name"},{default:s((()=>[d(v(l.productName),1)])),_:2},1024),l.flavor&&l.flavor.length>0?(i(),o(u,{key:0,class:"item-flavors"},{default:s((()=>[r(a,null,{default:s((()=>[d(v(l.flavor.join(",")),1)])),_:2},1024)])),_:2},1024)):_("",!0)])),_:2},1024),r(u,{class:"item-price-quantity"},{default:s((()=>[r(a,{class:"item-price"},{default:s((()=>[d("¥"+v((parseFloat(l.price)*l.quantity).toFixed(2)),1)])),_:2},1024),r(u,{class:"quantity-control"},{default:s((()=>[r(u,{class:"quantity-button",onClick:e=>fl({...l,quantity:l.quantity-1})},{default:s((()=>[d("-")])),_:2},1032,["onClick"]),r(a,{class:"quantity-text"},{default:s((()=>[d(v(l.quantity),1)])),_:2},1024),r(u,{class:"quantity-button",onClick:e=>fl({...l,quantity:l.quantity+1})},{default:s((()=>[d("+")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),0===P.value.length?(i(),o(u,{key:0,class:"empty-cart-placeholder"},{default:s((()=>[r(a,null,{default:s((()=>[d("购物车是空的哦")])),_:1})])),_:1})):_("",!0)])),_:1}),r(u,{class:"modal-footer"})])),_:1})])),_:1})):_("",!0),r(N,{show:R.value,product:G.value,onClose:e[2]||(e[2]=l=>R.value=!1),onOpenFlavorModal:cl},null,8,["show","product"]),r(j,{show:T.value,product:G.value,allFlavors:H.value,initialQuantity:Q.value,initialSelectedFlavors:B.value,onClose:e[3]||(e[3]=l=>T.value=!1),onConfirm:il},null,8,["show","product","allFlavors","initialQuantity","initialSelectedFlavors"])])),_:1})}}},[["__scopeId","data-v-0b346cae"]]);export{J as default};
