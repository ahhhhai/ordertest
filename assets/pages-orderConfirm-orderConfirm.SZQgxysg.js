import{A as e,B as l,E as a,s as t,y as o,a as s,b as u,i as n,o as c,g as d,k as i,l as r,m as f,F as m,t as p,h as v,N as _,O as b,P as h,Q as y,p as g,M as w,q as V}from"./index-BQ09tla7.js";import{o as k}from"./uni-app.es.Ci_EXitp.js";import{n as x}from"./newRequest.CdYp5UiF.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const q=C({__name:"orderConfirm",setup(C){const q=e([]),N=e(""),U=e(!1),j=e(""),F=e(""),I=e(null),T=e(null),O=e(""),M=l((()=>q.value.reduce(((e,l)=>e+l.quantity),0))),P=l((()=>q.value.reduce(((e,l)=>e+parseFloat(l.price)*l.quantity),0)));k((e=>{try{const e=a("checkoutCart");e?q.value=JSON.parse(e):(t({title:"未获取到购物车数据，请重新点餐",icon:"none"}),setTimeout((()=>{o({url:"/pages/firstpage/firstpage"})}),1500))}catch(l){console.error("获取购物车数据失败:",l),t({title:"加载购物车数据异常",icon:"none"}),setTimeout((()=>{o({url:"/pages/firstpage/firstpage"})}),1500)}e.tableNumber&&(T.value=e.tableNumber),e.peopleCount&&(I.value=parseInt(e.peopleCount),isNaN(I.value)&&(I.value=null))}));const R=()=>{_()},S=()=>{console.log("继续点单"),_({delta:1})},A=()=>{console.log("显示服务员确认弹窗"),0!==q.value.length?U.value=!0:t({title:"购物车是空的，无法下单",icon:"none"})},B=()=>{U.value=!1},E=async()=>{if(console.log("尝试下单..."),!j.value||!F.value)return void t({title:"请填写服务员账号和密码",icon:"none"});if(null===I.value||I.value<=0)return void t({title:"请填写有效的人数",icon:"none"});if(!T.value)return void t({title:"请填写台号",icon:"none"});if(!O.value)return void t({title:"请填写手牌号",icon:"none"});if(0===q.value.length)return void t({title:"购物车是空的，无法下单",icon:"none"});b({title:"下单中...",mask:!0});const e=encodeURIComponent("下单"),l={brand_id:O.value,user_name:j.value,password:F.value,diner_count:I.value,table_number:T.value,allmemo:N.value||"",items:q.value.map((e=>({id:e.productId,count:e.quantity,flavors:e.flavor&&e.flavor.length>0?e.flavor.join(","):""})))};console.log("准备发送的下单数据 (data 参数):",l),console.log("准备发送的 type 参数:",e);try{const a=await x("http://192.168.3.150:5921","/insertCommond","POST",e,l);a&&200===a.code?(t({title:"下单成功",icon:"success"}),B(),h("checkoutCart"),setTimeout((()=>{o({url:"/pages/index/index"})}),1500)):t({title:a.msg||"下单失败，请重试",icon:"none"})}catch(a){console.error("下单请求失败:",a),t({title:"下单请求异常，请检查网络或稍后再试",icon:"none"})}finally{y()}};return(e,l)=>{const a=n,t=g,o=w,_=V;return c(),s(a,{class:"checkout-container"},{default:u((()=>[d(a,{class:"header"},{default:u((()=>[d(a,{class:"back-button",onClick:R}),d(a,{class:"header-title"},{default:u((()=>[i("结算中心")])),_:1}),d(a,{class:"more-options"},{default:u((()=>[i("...")])),_:1})])),_:1}),d(a,{class:"main-content"},{default:u((()=>[d(a,{class:"section"},{default:u((()=>[d(a,{class:"section-title"},{default:u((()=>[i("餐品信息")])),_:1}),d(a,{class:"item-list"},{default:u((()=>[(c(!0),r(m,null,f(q.value,((e,l)=>(c(),s(a,{key:l,class:"item"},{default:u((()=>[d(a,{class:"item-details"},{default:u((()=>[d(t,{class:"item-name"},{default:u((()=>[i(p(e.productName),1)])),_:2},1024),e.flavor&&e.flavor.length>0?(c(),s(t,{key:0,class:"item-flavors"},{default:u((()=>[i("("+p(e.flavor.join(","))+")",1)])),_:2},1024)):v("",!0)])),_:2},1024),d(a,{class:"item-quantity"},{default:u((()=>[i(p(e.quantity)+"份",1)])),_:2},1024),d(a,{class:"item-price"},{default:u((()=>[i("¥"+p(parseFloat(e.price*e.quantity).toFixed(2)),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),d(a,{class:"total-info"},{default:u((()=>[d(t,null,{default:u((()=>[i("共"+p(M.value)+"份",1)])),_:1}),d(t,null,{default:u((()=>[i("¥"+p(P.value.toFixed(2)),1)])),_:1})])),_:1})])),_:1}),d(a,{class:"section remark-section"},{default:u((()=>[d(a,{class:"section-title"},{default:u((()=>[i("顾客备注")])),_:1}),d(o,{class:"remark-input",type:"text",placeholder:"请输入您的要求",modelValue:N.value,"onUpdate:modelValue":l[0]||(l[0]=e=>N.value=e)},null,8,["modelValue"])])),_:1}),d(a,{class:"flex-spacer"})])),_:1}),d(a,{class:"footer"},{default:u((()=>[d(a,{class:"continue-ordering-button",onClick:S},{default:u((()=>[i("继续点单")])),_:1}),d(a,{class:"confirm-order-button",onClick:A},{default:u((()=>[i("确认下单")])),_:1})])),_:1}),U.value?(c(),s(a,{key:0,class:"modal-overlay"},{default:u((()=>[d(a,{class:"modal-content"},{default:u((()=>[d(a,{class:"modal-header"},{default:u((()=>[d(a,{class:"close-button",onClick:B},{default:u((()=>[i("×")])),_:1}),d(a,{class:"modal-title"},{default:u((()=>[i("通知服务员确认")])),_:1}),d(a,{class:"placeholder"})])),_:1}),d(a,{class:"modal-body"},{default:u((()=>[d(a,{class:"modal-row"},{default:u((()=>[d(t,{class:"row-label"},{default:u((()=>[i("服务员账号")])),_:1}),d(o,{class:"row-input",type:"text",placeholder:"请输入服务员账号",modelValue:j.value,"onUpdate:modelValue":l[1]||(l[1]=e=>j.value=e)},null,8,["modelValue"])])),_:1}),d(a,{class:"modal-row"},{default:u((()=>[d(t,{class:"row-label"},{default:u((()=>[i("密码")])),_:1}),d(o,{class:"row-input",type:"password",placeholder:"请输入密码",modelValue:F.value,"onUpdate:modelValue":l[2]||(l[2]=e=>F.value=e)},null,8,["modelValue"])])),_:1}),d(a,{class:"modal-row"},{default:u((()=>[d(t,{class:"row-label"},{default:u((()=>[i("人数")])),_:1}),d(o,{class:"row-input text-right",type:"number",modelValue:I.value,"onUpdate:modelValue":l[3]||(l[3]=e=>I.value=e),modelModifiers:{number:!0}},null,8,["modelValue"])])),_:1}),d(a,{class:"modal-row"},{default:u((()=>[d(t,{class:"row-label"},{default:u((()=>[i("台号")])),_:1}),d(o,{class:"row-input text-right",type:"text",modelValue:T.value,"onUpdate:modelValue":l[4]||(l[4]=e=>T.value=e)},null,8,["modelValue"])])),_:1}),d(a,{class:"modal-row"},{default:u((()=>[d(t,{class:"row-label"},{default:u((()=>[i("手牌")])),_:1}),d(a,{class:"input-with-icon"},{default:u((()=>[d(o,{class:"row-input",type:"text",placeholder:"请输入手牌号",modelValue:O.value,"onUpdate:modelValue":l[5]||(l[5]=e=>O.value=e)},null,8,["modelValue"]),d(a,{class:"scan-icon"},{default:u((()=>[d(t,{class:"iconfont icon-scan"})])),_:1})])),_:1})])),_:1})])),_:1}),d(a,{class:"modal-footer"},{default:u((()=>[d(_,{class:"confirm-button",onClick:E},{default:u((()=>[i("确定")])),_:1})])),_:1})])),_:1})])),_:1})):v("",!0)])),_:1})}}},[["__scopeId","data-v-64ba0cd6"]]);export{q as default};
